name: Build PBR

on:
  schedule:
    - cron: "2 0/1 * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: download cidr
      run: |
        chmod +x ros-dpbr.sh
        ./ros-dpbr.sh

     # 本地提交
    - name: Commit files
      run: |
         git rm CN.rsc
         git commit -m "删除旧有IP文件!"
         git add CN.rsc
         git commit -m "提交新的chn_ip.txt和chnroute.txt文件，更新于$(date "+%Y-%m-%d %H:%M:%S")"
         
    # 更新至远程github代码仓库中
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
